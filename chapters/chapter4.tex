%************************************************
\chapter{Local algorithm}\label{ch:local}
%************************************************

In this Chapter will be defined a local Metropolis-Hastings algorithm that samples the link variables.
Then, a specific local algorithm will be defined to compute the integral of Equation \eqref{eq:lat_exp}.
The first simulation will be run,
and the result of the plaquette mean value will be compared with the value reported by D\"urr and Hoelbling in 2005 \cite{durr-hoelbling:2005}.

However, since the algorithm is local, at small lattice spacing, the topological freezing will be encountered.

\section{Link variables updating}
\subsection*{Heat-bath}
%\begin{align*}
%    S &= \beta\sum_s\left(1-\Re\,U[\mathcal P(s)]\right) \\
%    \Delta S &= -\beta\Re\,\left(U[\mathcal S_0]U[\mathcal L] + U[\mathcal S_1]U[\mathcal L]\right) \\
%             &= -\beta\Re\,(Wu) \\
%             &= -\beta|W|\cos(\phi + \arg W) \\
%             &= e^{-k\cos(x)}
%\end{align*}
The probability density function of links configurations $\{U\}$ is:
\[
    p(U) \propto e^{-S}
\]
in which the action $S$ is:
\[
    S = \beta\sum_s\left(1-\Re\,U[\mathcal P(s)]\right)
\]
Every plaquette value $\Re\,U[\mathcal P(s)]$ depends on four links variables,
and every link variable contributes to two different plaquettes.

Links variables are then simultaneously coupled in their probability density function,
which is then impossible to sample directly.

However, the action has a local nature,
since every link variable contributes only to the two plaquettes that include it.
Thus, using the heat-bath approach and considering only the marginal distribution of one link variable,
the contribution of all plaquettes that do not include the link can be integrated out of the distribution.

Let $\mathcal L$ be the link considered, and $\mathcal P_1, \mathcal P_2$ the two plaquettes that include it.
The two paths $\mathcal S_1, \mathcal S_2$ sketched in Figure \ref{fig:staples}
are called \emph{staples}.
They are all the staples connected to $\mathcal L$,
in the sense that they are the staples that form a plaquette if $\mathcal L$ is included to them.

\begin{figure}[!htb]
    \centering
    \begin{tikzpicture}[x=5em,y=5em]
        \draw[step=1, help lines, dashed, color=black!30] (0,0) grid (3.5,2.5);
        \draw[->,thick,black] (0,0) -- (3.5,0) node [right] {$x_1$};
        \draw[->,thick,black] (0,0) -- (0,2.5) node [above] {$x_2$};

        \draw[->-,very thick,orange] (2,1) node [black,below] {$\mathcal L$} --  (2,2);

        %left staple
        \draw[->-,very thick,RoyalBlue] (2,2) -- (1,2);
        \draw[->-,very thick,RoyalBlue] (1,2) -- node [black,left] {$\mathcal S_1$} (1,1);
        \draw[->-,very thick,RoyalBlue] (1,1) -- (2,1);

        %right staple
        \draw[->-,very thick,RoyalBlue] (2,2) -- (3,2);
        \draw[->-,very thick,RoyalBlue] (3,2) -- node [black,right] {$\mathcal S_2$} (3,1);
        \draw[->-,very thick,RoyalBlue] (3,1) -- (2,1);

        %left plaq
        \draw[->-,thick,dashed,black] (1.2,1.2) -- (1.8,1.2);
        \draw[->-,thick,dashed,black] (1.8,1.2) -- (1.8,1.8);
        \draw[->-,thick,dashed,black] (1.8,1.8) -- (1.2,1.8);
        \draw[->-,thick,dashed,black] (1.2,1.8) -- (1.2,1.2);
        \node at (1.5,1.5) {$\mathcal P_1$};

        %right plaq
        \draw[->-,thick,dashed,black] (2.2,1.2) -- (2.8,1.2);
        \draw[->-,thick,dashed,black] (2.8,1.2) -- (2.8,1.8);
        \draw[->-,thick,dashed,black] (2.8,1.8) -- (2.2,1.8);
        \draw[->-,thick,dashed,black] (2.2,1.8) -- (2.2,1.2);
        \node at (2.5,1.5) {$\mathcal P_2$};

        %\node[anchor={north east}] at (1,1) {$\mathcal P_1$};
        %\node[anchor={north east}] at (2,1) {$\mathcal P_2$};

    \end{tikzpicture}
    \caption{Staples connected to a vertical link}
    \label{fig:staples}
\end{figure}

The contribution of $\mathcal P_1, \mathcal P_2$ to the action can be written in terms of
the link variable $u \equiv U[\mathcal L]$ in the following way:
\[\begin{aligned}
    \Re\,U[\mathcal P_1] + \Re\,U[\mathcal P_2] &= \Re\,(uU[\mathcal S_1]) + \Re\,(u^*U^*[\mathcal S_2]) \\
                                                &= \Re\,(Wu)
\end{aligned}\]
where $W \equiv U[\mathcal P_1] + U[\mathcal P_2] \notin U(1)$ has a modulus $|W|\neq1$.
One link $\mathcal L$ and $u \equiv U[\mathcal L]$ $u_\mathrm{fix}$
\[\begin{aligned}
    p(u;u_\mathrm{fix}) &\propto e^{-\beta(1-\Re(Wu))} \\
                        &\propto e^{\beta\Re(Wu)} \\
                        &= e^{\beta|W|\Re\left(\frac{W}{|W|}u\right)}
\end{aligned}\]
$\phi \equiv \arg u$, $\phi_0 \equiv \arg W$.
\[
	p(\phi;u_\mathrm{fix}) \propto e^{\beta|W|\cos(\phi + \phi_0)}
\]
 %   \Delta S = \beta \Re Wu = \beta|W| \Re \left(\frac{W}{|W|} u\right)
$x \equiv \phi + \phi_0$ $k \equiv \beta|W|$
\[
    p(x;u_\mathrm{fix}) \propto e^{-k\cos(x)}
\]

\[
	p(x) = e^{-k\cos(x)}
\]

\[
    e^{k\cos(x)} \stackrel{k\to\infty}{\scalebox{2}[1.25]{$\sim$}} e^{-kx^2/2}
\]

Laplace's method:
\[
	\int_a^b\mathrm dx\,e^{kf(x)} \xrightarrow{k\to\infty} e^{kf(x_0)}\int_a^b\mathrm dx\,e^{kf"(x_0)(x-x_0)^2/2}
\]

\[
    \int_{-\pi}^x\mathrm dx'\,e^{k\cos(x')} \stackrel{k\to\infty}{\scalebox{2}[1.25]{$\sim$}} \int_{-\pi}^x\mathrm dx'\,e^{-k{x'}^2/2}
\]
\[
    e^{k\cos(x)} \stackrel{k\to\infty}{\scalebox{2}[1.25]{$\sim$}} e^{-kx^2/2}
\]

\begin{figure}[!htb]
    \centering
    \input{plots/gauss.pgf}
    \caption{$p(x;u_\mathrm{fix})$ converges to a Gaussian as $k$ increases}
    \label{fig:gauss}
\end{figure}

\subsection*{Gaussian sampling}
\[
    p(x) \propto e^{-\frac{k}{2}x^2}
\]

\[
    p(x_1,x_2) \propto e^{-\frac{k}{2}(x_1^2+x_2^2)}
\]

\[\begin{dcases}
    x_1 = r \cos\theta \\
    x_2 = r \sin\theta \\
\end{dcases}\]

\[\begin{aligned}
    p(r,\theta) &= p(r)p(\theta) \\
                &= \left(\mathcal Nre^{-\frac{k}{2}r^2}\right)\left(\frac{1}{2\pi}\right)
\end{aligned}\]
\[
    F(r) = \int_0^r\mathrm dr'\,p(r') = \frac{\mathcal N}{k}\left.e^{-\frac{k}{2}{r'}^2}\right|_r^0 = \frac{\mathcal N}{k}\left(1-e^{-\frac{k}{2}r^2}\right) \equiv y_1
\]
\[
    r = F^{-1}(y_1) = \sqrt{-\frac{2}{k}\log\left(1-\frac{k}{\mathcal N}y_1\right)}
\]
\[
    \mathcal N^{-1} = \int_0^\pi\mathrm dr\,re^{-\frac{k}{2}r^2} = \frac{1}{k}\left(1-e^{-\frac{k}{2}\pi^2}\right)
\]
\begin{equation*}
    \begin{dcases}
        x_1 = -\frac{k}{2}\log\left[1-y_1\left(1-e^{-\frac{k}{2}\pi^2}\right)\right]\cos(2\pi y_2) \\
        x_2 = -\frac{k}{2}\log\left[1-y_1\left(1-e^{-\frac{k}{2}\pi^2}\right)\right]\sin(2\pi y_2)
    \end{dcases}
\end{equation*}

\subsection{Local Metropolis-Hastings}

\section{First results}

\subsection{Plaquette mean value}

\subsection{Topological freezing}

%*****************************************
%*****************************************
%*****************************************
%*****************************************
%*****************************************
